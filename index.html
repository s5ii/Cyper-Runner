<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ØºØ§Ù…Ø±Ø§Øª Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§ âš”ï¸</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Amiri:wght@700&display=swap" rel="stylesheet">
<style>
:root{--primary:#ff2e63;--secondary:#08d9d6;--accent:#ffbb00;--bg:#070b1a;--bg2:#0d1230;--card:rgba(12,16,45,0.97);--neon:0 0 20px rgba(8,217,214,0.5);--fire:0 0 20px rgba(255,46,99,0.5);--gold:0 0 15px rgba(255,187,0,0.5);}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Cairo',sans-serif;background:var(--bg);color:#fff;overflow:hidden;height:100vh;}
.screen{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:10;}
.auth-bg-effects{position:absolute;inset:0;background:radial-gradient(circle at 20% 30%,rgba(255,46,99,.15),transparent 50%),radial-gradient(circle at 80% 70%,rgba(8,217,214,.15),transparent 50%);pointer-events:none;}
.auth-wrapper{position:relative;z-index:2;width:100%;max-width:500px;padding:1.5rem;animation:fadeUp .6s ease;}
.auth-logo{text-align:center;margin-bottom:1.2rem;}
.logo-top{display:block;font-size:2.4rem;color:var(--secondary);text-shadow:0 0 20px var(--secondary),0 0 40px var(--secondary);font-family:'Amiri',serif;font-weight:700;}
.logo-bottom{display:block;font-size:3.2rem;background:linear-gradient(135deg,#ff2e63,#ff6b35);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;font-family:'Amiri',serif;font-weight:700;}
.auth-card{background:var(--card);border:2px solid rgba(8,217,214,.3);border-radius:20px;padding:2rem;box-shadow:var(--neon),0 20px 60px rgba(0,0,0,.8);}
.auth-card-title{font-size:1.5rem;color:var(--secondary);text-align:center;margin-bottom:1.5rem;font-weight:700;}
.field{display:flex;flex-direction:column;gap:.4rem;margin-bottom:1.1rem;}
.field label{font-size:.95rem;color:rgba(255,255,255,.8);font-weight:700;}
.field input{padding:.9rem 1rem;border-radius:12px;border:2px solid rgba(8,217,214,.25);background:rgba(8,217,214,.08);color:#fff;font-size:1rem;font-family:'Cairo',sans-serif;text-align:right;transition:all .3s;}
.field input:focus{outline:none;border-color:var(--secondary);background:rgba(8,217,214,.15);box-shadow:var(--neon);}
.field input::placeholder{color:rgba(255,255,255,.35);}
.auth-error{min-height:1.2rem;color:#ff5e5e;font-size:.85rem;text-align:center;font-weight:700;margin-bottom:.3rem;}
.auth-submit-btn{width:100%;padding:1rem;border:none;border-radius:12px;background:linear-gradient(135deg,#ff2e63,#ff6b35);color:#fff;font-size:1.1rem;font-weight:900;font-family:'Cairo',sans-serif;cursor:pointer;transition:all .3s;letter-spacing:.05em;}
.auth-submit-btn:hover{transform:translateY(-3px);box-shadow:0 0 30px rgba(255,46,99,.7);}
.auth-switch{text-align:center;margin-top:1.2rem;color:rgba(255,255,255,.6);font-size:.9rem;}
.auth-switch a{color:var(--secondary);font-weight:700;text-decoration:none;}
.auth-switch a:hover{color:var(--accent);}
#mainScreen{display:none;flex-direction:column;overflow:hidden;background:var(--bg);}
.main-stars{position:absolute;inset:0;pointer-events:none;}
.main-stars::before{content:'';position:absolute;inset:0;background-image:radial-gradient(2px 2px at 10% 20%,white,transparent),radial-gradient(1px 1px at 30% 50%,white,transparent),radial-gradient(2px 2px at 60% 15%,white,transparent),radial-gradient(1px 1px at 80% 70%,white,transparent),radial-gradient(2px 2px at 50% 85%,rgba(8,217,214,.8),transparent),radial-gradient(1px 1px at 20% 80%,rgba(255,187,0,.8),transparent),radial-gradient(2px 2px at 90% 30%,rgba(255,46,99,.8),transparent),radial-gradient(1px 1px at 40% 60%,white,transparent),radial-gradient(2px 2px at 70% 40%,white,transparent),radial-gradient(1px 1px at 15% 45%,white,transparent);animation:twinkle 4s infinite alternate;opacity:.5;}
@keyframes twinkle{0%{opacity:.2}100%{opacity:.8}}
.main-header{display:flex;align-items:center;justify-content:space-between;padding:.8rem 1.5rem;background:rgba(7,11,26,.97);border-bottom:2px solid rgba(8,217,214,.2);z-index:20;flex-shrink:0;box-shadow:0 2px 20px rgba(0,0,0,.5);}
.player-badge{display:flex;align-items:center;gap:.7rem;}
.player-avatar{font-size:2rem;}
.player-info{display:flex;flex-direction:column;gap:.1rem;}
.player-name{font-size:1rem;font-weight:900;color:var(--accent);}
.player-coins{font-size:.85rem;color:var(--secondary);font-weight:700;}
.main-game-title{font-size:1.6rem;font-weight:900;font-family:'Amiri',serif;background:linear-gradient(135deg,var(--secondary),var(--primary));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;text-align:center;}
.logout-header-btn{padding:.6rem 1.2rem;background:rgba(255,46,99,.15);border:2px solid rgba(255,46,99,.4);color:#fff;border-radius:10px;cursor:pointer;font-family:'Cairo',sans-serif;font-weight:700;font-size:.85rem;transition:all .3s;}
.logout-header-btn:hover{background:rgba(255,46,99,.5);box-shadow:var(--fire);}
.bottom-nav{display:flex;background:rgba(7,11,26,.97);border-top:2px solid rgba(8,217,214,.2);flex-shrink:0;z-index:20;order:3;}
.nav-btn{flex:1;padding:.8rem;border:none;background:transparent;color:rgba(255,255,255,.5);font-family:'Cairo',sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .3s;border-top:3px solid transparent;}
.nav-btn.active{color:var(--secondary);border-top-color:var(--secondary);background:rgba(8,217,214,.08);}
.nav-btn:hover{color:#fff;}
.main-content{flex:1;overflow-y:auto;padding:1.2rem;z-index:1;position:relative;}
.main-content::-webkit-scrollbar{width:4px;}
.main-content::-webkit-scrollbar-thumb{background:var(--secondary);border-radius:2px;}
.tab-pane{display:none;}
.tab-pane.active{display:block;}
.section-title{font-size:1.3rem;font-weight:900;color:var(--accent);margin-bottom:1rem;text-align:center;text-shadow:var(--gold);}
.levels-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:.8rem;}
.level-card{background:var(--card);border:2px solid rgba(8,217,214,.2);border-radius:16px;padding:1rem;text-align:center;cursor:pointer;transition:all .3s;position:relative;overflow:hidden;}
.level-card:hover:not(.locked){transform:translateY(-4px);box-shadow:var(--neon);}
.level-card.locked{opacity:.5;cursor:not-allowed;}
.level-card.completed{border-color:rgba(255,187,0,.5);background:rgba(255,187,0,.06);}
.level-card.secret{border-color:rgba(255,46,99,.5);background:rgba(255,46,99,.06);animation:secretPulse 2s infinite;}
.level-card.boss{border-color:rgba(180,0,255,.5);background:rgba(180,0,255,.06);}
@keyframes secretPulse{0%,100%{box-shadow:0 0 8px rgba(255,46,99,.3)}50%{box-shadow:0 0 22px rgba(255,46,99,.7)}}
.level-icon{font-size:2rem;margin-bottom:.4rem;display:block;}
.level-num{font-size:1rem;font-weight:900;color:#fff;margin-bottom:.2rem;}
.level-name{font-size:.7rem;color:rgba(255,255,255,.6);margin-bottom:.4rem;}
.level-stars{font-size:.85rem;margin-top:.3rem;}
.level-lock{font-size:1.5rem;position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);border-radius:14px;}
.level-difficulty{font-size:.65rem;padding:.15rem .5rem;border-radius:6px;font-weight:700;display:inline-block;}
.diff-easy{background:rgba(0,255,136,.15);color:#00ff88;}
.diff-med{background:rgba(255,187,0,.15);color:var(--accent);}
.diff-hard{background:rgba(255,46,99,.15);color:var(--primary);}
.diff-boss{background:rgba(180,0,255,.15);color:#cc44ff;}
.diff-secret{background:rgba(255,105,180,.15);color:#ff69b4;}
.shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:.8rem;}
.shop-item{background:var(--card);border:2px solid rgba(8,217,214,.2);border-radius:16px;padding:1.2rem;text-align:center;transition:all .3s;}
.shop-item:hover:not(.owned){transform:translateY(-3px);box-shadow:var(--neon);}
.shop-item.owned{border-color:rgba(255,187,0,.4);}
.shop-icon{font-size:2.5rem;margin-bottom:.5rem;display:block;}
.shop-name{font-size:.95rem;font-weight:900;color:#fff;margin-bottom:.3rem;}
.shop-desc{font-size:.72rem;color:rgba(255,255,255,.55);margin-bottom:.7rem;line-height:1.4;}
.shop-price{font-size:.9rem;font-weight:900;color:var(--accent);margin-bottom:.6rem;}
.shop-buy-btn{width:100%;padding:.6rem;border:none;border-radius:10px;background:linear-gradient(135deg,#ff2e63,#ff6b35);color:#fff;font-family:'Cairo',sans-serif;font-weight:700;font-size:.85rem;cursor:pointer;transition:all .3s;}
.shop-buy-btn:hover:not(:disabled){transform:scale(1.05);box-shadow:var(--fire);}
.shop-buy-btn.owned-btn{background:linear-gradient(135deg,#ffbb00,#ff8c00);}
.shop-buy-btn:disabled{background:rgba(255,255,255,.1);color:rgba(255,255,255,.3);cursor:not-allowed;}
.profile-card{background:var(--card);border:2px solid rgba(8,217,214,.2);border-radius:20px;padding:2rem;text-align:center;max-width:500px;margin:0 auto;}
.profile-avatar-big{font-size:5rem;margin-bottom:.5rem;}
.profile-card h2{font-size:1.4rem;font-weight:900;color:var(--accent);margin-bottom:1.5rem;}
.profile-stats{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin-bottom:1rem;}
.pstat{background:rgba(8,217,214,.08);border:1px solid rgba(8,217,214,.2);border-radius:12px;padding:.8rem;}
.pv{display:block;font-size:1.5rem;font-weight:900;color:var(--secondary);}
.pl{font-size:.75rem;color:rgba(255,255,255,.6);}
.owned-list{display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center;margin-top:.8rem;min-height:2rem;}
.owned-tag{background:rgba(255,187,0,.12);border:1px solid rgba(255,187,0,.3);border-radius:8px;padding:.3rem .7rem;font-size:.8rem;color:var(--accent);}
#gameScreen{flex-direction:column;background:#070b1a;}
.game-hud{display:flex;gap:.8rem;align-items:center;justify-content:center;padding:.5rem 1rem;background:rgba(5,8,20,.97);border-bottom:2px solid rgba(8,217,214,.2);flex-shrink:0;flex-wrap:wrap;}
.hud-item{font-size:.95rem;font-weight:900;color:var(--accent);background:rgba(8,217,214,.08);padding:.3rem .8rem;border-radius:8px;border:1px solid rgba(8,217,214,.2);}
.ingame-user{position:fixed;top:56px;right:15px;font-size:.8rem;font-weight:700;color:var(--secondary);z-index:50;background:rgba(5,8,20,.85);padding:.3rem .7rem;border-radius:8px;border:1px solid rgba(8,217,214,.2);}
.admin-badge{background:linear-gradient(135deg,#ff2e63,#ff6b35);padding:.1rem .4rem;border-radius:5px;font-size:.65rem;font-weight:900;margin-left:.3rem;}
#gameCanvas{display:block;margin:0 auto;}
.pause-btn{position:fixed;top:56px;left:15px;background:rgba(5,8,20,.9);border:2px solid rgba(8,217,214,.3);color:#fff;font-size:1.2rem;width:42px;height:42px;border-radius:50%;cursor:pointer;transition:all .3s;z-index:50;}
.pause-btn:hover{box-shadow:var(--neon);}
.admin-panel{position:fixed;bottom:20px;right:15px;background:rgba(5,5,20,.97);border:2px solid rgba(255,187,0,.5);border-radius:14px;padding:.8rem;z-index:200;min-width:215px;box-shadow:0 0 20px rgba(255,187,0,.3);}
.ap-title{color:var(--accent);font-weight:900;font-size:.9rem;text-align:center;margin-bottom:.6rem;border-bottom:1px solid rgba(255,187,0,.3);padding-bottom:.4rem;}
.ap-lvl-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:.3rem;margin-bottom:.6rem;}
.ap-lvl-btn{padding:.3rem;background:rgba(8,217,214,.1);border:1px solid rgba(8,217,214,.3);color:var(--secondary);border-radius:6px;cursor:pointer;font-size:.8rem;font-weight:900;font-family:'Cairo',sans-serif;transition:all .2s;}
.ap-lvl-btn:hover{background:rgba(8,217,214,.35);transform:scale(1.1);}
.ap-lvl-btn.ap-active{background:var(--secondary);color:#000;}
.ap-actions{display:flex;gap:.4rem;}
.ap-btn{flex:1;padding:.4rem .2rem;background:rgba(255,46,99,.15);border:1px solid rgba(255,46,99,.35);color:#fff;border-radius:7px;cursor:pointer;font-size:.72rem;font-weight:700;font-family:'Cairo',sans-serif;transition:all .2s;}
.ap-btn:hover{background:rgba(255,46,99,.4);}
.ap-btn.ap-active{background:linear-gradient(135deg,#08d9d6,#004d4d)!important;border-color:#08d9d6!important;}
.overlay-screen{background:rgba(0,0,0,.82);backdrop-filter:blur(8px);}
.overlay-card{background:var(--card);border:2px solid rgba(8,217,214,.3);border-radius:24px;padding:2.5rem;text-align:center;min-width:320px;max-width:420px;box-shadow:var(--neon),0 20px 60px rgba(0,0,0,.8);display:flex;flex-direction:column;gap:1rem;animation:popIn .4s cubic-bezier(.175,.885,.32,1.275);}
.overlay-card h2{font-size:1.8rem;font-weight:900;}
.over-title{background:linear-gradient(135deg,#ff2e63,#ff6b35);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;}
.win-title{background:linear-gradient(135deg,#08d9d6,#4facfe);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;}
.result-stats{display:flex;gap:.8rem;justify-content:center;}
.rs{display:flex;flex-direction:column;align-items:center;background:rgba(8,217,214,.08);border:1px solid rgba(8,217,214,.2);border-radius:12px;padding:.7rem 1rem;}
.rs span{font-size:1.4rem;font-weight:900;color:var(--accent);}
.rs small{font-size:.75rem;color:rgba(255,255,255,.6);}
.stars-row{font-size:2rem;letter-spacing:.3rem;}
.btn-fire{padding:.9rem 2rem;border:none;border-radius:12px;background:linear-gradient(135deg,#ff2e63,#ff6b35);color:#fff;font-family:'Cairo',sans-serif;font-size:1rem;font-weight:700;cursor:pointer;transition:all .3s;}
.btn-fire:hover{transform:translateY(-3px);box-shadow:var(--fire);}
.btn-ice{padding:.9rem 2rem;border:none;border-radius:12px;background:linear-gradient(135deg,#08d9d6,#4facfe);color:#fff;font-family:'Cairo',sans-serif;font-size:1rem;font-weight:700;cursor:pointer;transition:all .3s;}
.btn-ice:hover{transform:translateY(-3px);box-shadow:var(--neon);}
.btn-dark{padding:.9rem 2rem;border:2px solid rgba(255,255,255,.2);border-radius:12px;background:transparent;color:rgba(255,255,255,.7);font-family:'Cairo',sans-serif;font-size:1rem;font-weight:700;cursor:pointer;transition:all .3s;}
.btn-dark:hover{background:rgba(255,255,255,.1);}
.admin-owner-badge{background:linear-gradient(135deg,#ff2e63,#ff6b35);color:#fff;font-size:.65rem;padding:.15rem .5rem;border-radius:6px;font-weight:900;animation:pulse 2s infinite;}
.game-notification{position:fixed;top:80px;left:50%;transform:translateX(-50%);background:rgba(5,8,20,.97);border:2px solid var(--accent);border-radius:12px;padding:.7rem 1.5rem;font-weight:700;color:var(--accent);z-index:1000;font-size:.95rem;animation:notifAnim .4s ease;white-space:nowrap;pointer-events:none;}
@keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{from{transform:scale(.7);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
@keyframes notifAnim{from{opacity:0;transform:translateX(-50%) translateY(-20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-thumb{background:var(--secondary);border-radius:2px;}
</style>
</head>
<body>

<!-- ØªØ³Ø¬ÙŠÙ„ -->
<div id="registerScreen" class="screen">
  <div class="auth-bg-effects"></div>
  <div class="auth-wrapper">
    <div class="auth-logo"><span class="logo-top">Ù…ØºØ§Ù…Ø±Ø§Øª</span><span class="logo-bottom">Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§ âš”ï¸</span></div>
    <div class="auth-card">
      <h2 class="auth-card-title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      <form id="registerForm">
        <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label><input type="text" id="reg_user" placeholder="Ù…Ø«Ø§Ù„: ninja2024" required></div>
        <div class="field"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input type="password" id="reg_pass" placeholder="4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" required></div>
        <div class="field"><label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input type="password" id="reg_confirm" placeholder="Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required></div>
        <div class="auth-error" id="reg_error"></div>
        <button type="submit" class="auth-submit-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ¨</button>
      </form>
      <p class="auth-switch">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" id="toLogin">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></p>
    </div>
  </div>
</div>

<!-- Ø¯Ø®ÙˆÙ„ -->
<div id="loginScreen" class="screen">
  <div class="auth-bg-effects"></div>
  <div class="auth-wrapper">
    <div class="auth-logo"><span class="logo-top">Ù…ØºØ§Ù…Ø±Ø§Øª</span><span class="logo-bottom">Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§ âš”ï¸</span></div>
    <div class="auth-card">
      <h2 class="auth-card-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <form id="loginForm">
        <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label><input type="text" id="log_user" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" required></div>
        <div class="field"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input type="password" id="log_pass" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required></div>
        <div class="auth-error" id="log_error"></div>
        <button type="submit" class="auth-submit-btn">Ø¯Ø®ÙˆÙ„ ğŸ®</button>
      </form>
      <p class="auth-switch">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" id="toRegister">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a></p>
    </div>
  </div>
</div>

<!-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="mainScreen" class="screen">
  <div class="main-stars"></div>
  <header class="main-header">
    <div class="player-badge">
      <span class="player-avatar">ğŸ¥·</span>
      <div class="player-info">
        <span class="player-name" id="mainUsername"></span>
        <span class="player-coins">ğŸ’ <span id="mainCoins">0</span></span>
      </div>
    </div>
    <h1 class="main-game-title">Ù…ØºØ§Ù…Ø±Ø§Øª Ø§Ù„Ù†ÙŠÙ†Ø¬Ø§</h1>
    <button class="logout-header-btn" id="logoutBtn">Ø®Ø±ÙˆØ¬ ğŸšª</button>
  </header>
  <div class="main-content" id="mainContent">
    <div class="tab-pane active" id="levelsTab">
      <h2 class="section-title">ğŸ—ºï¸ Ø§Ø®ØªØ± Ù…Ø±Ø­Ù„ØªÙƒ</h2>
      <div class="levels-grid" id="levelsGrid"></div>
    </div>
    <div class="tab-pane" id="shopTab">
      <h2 class="section-title">ğŸª Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h2>
      <div class="shop-grid" id="shopGrid"></div>
    </div>
    <div class="tab-pane" id="profileTab">
      <div class="profile-card">
        <div class="profile-avatar-big">ğŸ¥·</div>
        <h2 id="profileName"></h2>
        <div class="profile-stats">
          <div class="pstat"><span class="pv" id="pTotalCoins">0</span><span class="pl">ğŸ’ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙˆÙŠÙ†</span></div>
          <div class="pstat"><span class="pv" id="pLevelsUnlocked">1</span><span class="pl">ğŸ”“ Ù…Ø±Ø§Ø­Ù„ Ù…ÙØªÙˆØ­Ø©</span></div>
          <div class="pstat"><span class="pv" id="pBestLevel">1</span><span class="pl">ğŸ† Ø£Ø¹Ù„Ù‰ Ù…Ø±Ø­Ù„Ø©</span></div>
          <div class="pstat"><span class="pv" id="pItems">0</span><span class="pl">ğŸ’ Ù…Ù‚ØªÙ†ÙŠØ§Øª</span></div>
        </div>
        <h3 style="color:#08d9d6;margin-top:1.2rem;font-size:1rem;">ğŸ’ Ù…Ù‚ØªÙ†ÙŠØ§ØªÙŠ</h3>
        <div class="owned-list" id="ownedList"></div>
      </div>
    </div>
  </div>
  <nav class="bottom-nav">
    <button class="nav-btn active" onclick="switchTab('levels')">ğŸ—ºï¸ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</button>
    <button class="nav-btn" onclick="switchTab('shop')">ğŸª Ø§Ù„Ù…ØªØ¬Ø±</button>
    <button class="nav-btn" onclick="switchTab('profile')">ğŸ‘¤ Ù…Ù„ÙÙŠ</button>
  </nav>
</div>

<!-- Ø§Ù„Ù„Ø¹Ø¨Ø© -->
<div id="gameScreen" class="screen">
  <div class="game-hud">
    <div class="hud-item">ğŸ’ <span id="scoreDisplay">0</span></div>
    <div class="hud-item">Ù… <span id="levelDisplay">1</span></div>
    <div class="hud-item">â± <span id="timeDisplay">0:00</span></div>
    <div class="hud-item">â¤ï¸ <span id="livesDisplay">3</span></div>
    <div class="hud-item" id="shieldHud" style="display:none">ğŸ›¡ï¸ Ø¯Ø±Ø¹</div>
    <div class="hud-item" id="speedHud" style="display:none">âš¡ Ø³Ø±ÙŠØ¹</div>
  </div>
  <div class="ingame-user" id="ingameUser"></div>
  <canvas id="gameCanvas"></canvas>
  <button class="pause-btn" id="pauseBtn">â¸</button>
  <div class="admin-panel" id="adminPanel" style="display:none">
    <div class="ap-title">ğŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
    <div id="apLevelGrid" class="ap-lvl-grid"></div>
    <div class="ap-actions">
      <button class="ap-btn" id="btnInvincible" onclick="adminToggleInvincible()">ğŸ›¡ï¸ Ù…Ù†Ø§Ø¹Ø©</button>
      <button class="ap-btn" onclick="adminSkipLevel()">â­ï¸ ØªØ®Ø·ÙŠ</button>
      <button class="ap-btn" onclick="adminAddLives()">ğŸ’– âˆ</button>
    </div>
  </div>
</div>

<!-- Ø¥ÙŠÙ‚Ø§Ù -->
<div id="pauseScreen" class="screen overlay-screen">
  <div class="overlay-card">
    <h2>â¸ï¸ ØªÙˆÙ‚Ù</h2>
    <button class="btn-fire" id="resumeBtn">â–¶ï¸ Ù…ØªØ§Ø¨Ø¹Ø©</button>
    <button class="btn-ice" id="restartBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø©</button>
    <button class="btn-dark" id="quitBtn">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
  </div>
</div>

<!-- Ø®Ø³Ø§Ø±Ø© -->
<div id="gameOverScreen" class="screen overlay-screen">
  <div class="overlay-card">
    <h2 class="over-title">ğŸ’€ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
    <div class="result-stats">
      <div class="rs"><span id="go_score">0</span><small>Ù†Ù‚Ø§Ø·</small></div>
      <div class="rs"><span id="go_level">1</span><small>Ù…Ø±Ø­Ù„Ø©</small></div>
      <div class="rs"><span id="go_time">0:00</span><small>ÙˆÙ‚Øª</small></div>
    </div>
    <div class="stars-row" id="go_stars"></div>
    <button class="btn-fire" id="playAgainBtn">ğŸ”„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button>
    <button class="btn-dark" id="goToMenuBtn">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
  </div>
</div>

<!-- ÙÙˆØ² -->
<div id="levelCompleteScreen" class="screen overlay-screen">
  <div class="overlay-card">
    <h2 class="win-title">ğŸ‰ Ø£Ø­Ø³Ù†Øª!</h2>
    <div class="result-stats">
      <div class="rs"><span id="lc_score">0</span><small>Ù†Ù‚Ø§Ø·</small></div>
      <div class="rs"><span id="lc_coins">0</span><small>ğŸ’ ÙƒÙˆÙŠÙ†</small></div>
      <div class="rs"><span id="lc_time">0:00</span><small>ÙˆÙ‚Øª</small></div>
    </div>
    <div class="stars-row" id="lc_stars"></div>
    <button class="btn-ice" id="nextLevelBtn">â¡ï¸ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
    <button class="btn-dark" id="lc_menuBtn">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
  </div>
</div>

<script>
const CONFIG={canvas:{width:1000,height:500},player:{width:38,height:48,speed:5,jumpPower:14,gravity:0.55,maxFall:14},enemy:{width:38,height:38,speed:1.8}};
const OWNER={username:'owner',password:'owner123'};
const SHOP_ITEMS=[
  {id:'shield',    name:'ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø­Ù…Ø§ÙŠØ©',  desc:'Ù…Ù†Ø§Ø¹Ø© Ù…Ø¤Ù‚ØªØ© 10 Ø«ÙˆØ§Ù†Ù ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©', price:50,  icon:'ğŸ›¡ï¸'},
  {id:'speed',     name:'âš¡ Ø¨ÙˆØª Ø§Ù„Ø³Ø±Ø¹Ø©',    desc:'Ø²ÙŠØ§Ø¯Ø© Ø³Ø±Ø¹Ø© Ø§Ù„Ø­Ø±ÙƒØ© 40%',                    price:80,  icon:'âš¡'},
  {id:'doublejump',name:'ğŸ¦… Ù‚ÙØ²Ø© Ù…Ø²Ø¯ÙˆØ¬Ø©',  desc:'Ø§Ù‚ÙØ² Ù…Ø±ØªÙŠÙ† ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡',                     price:120, icon:'ğŸ¦…'},
  {id:'magnet',    name:'ğŸ§² Ù…ØºÙ†Ø§Ø·ÙŠØ³',       desc:'Ø³Ø­Ø¨ Ø§Ù„ÙƒÙˆÙŠÙ† Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹',              price:100, icon:'ğŸ§²'},
  {id:'extralives',name:'ğŸ’– Ø­ÙŠØ§Ø© Ø¥Ø¶Ø§ÙÙŠØ©',  desc:'Ø§Ø¨Ø¯Ø£ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ø¨Ù€ 5 Ø­ÙŠÙˆØ§Øª',                price:150, icon:'ğŸ’–'},
  {id:'coinboost', name:'ğŸ’° Ù…Ø¶Ø§Ø¹Ù Ø§Ù„ÙƒÙˆÙŠÙ†', desc:'ÙƒÙ„ ÙƒÙˆÙŠÙ† ØªØ¬Ù…Ø¹Ù‡Ø§ ØªØ³Ø§ÙˆÙŠ Ø¶Ø¹ÙÙŠÙ†',              price:200, icon:'ğŸ’°'},
];
const LVL=[
  {id:1,name:'Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©',    icon:'ğŸŒ±',diff:'easy',  secret:false,boss:false},
  {id:2,name:'Ø§Ù„Ø³Ù‡Ù„',      icon:'ğŸŒ¿',diff:'easy',  secret:false,boss:false},
  {id:3,name:'Ø§Ù„ØªØ­Ø¯ÙŠ',     icon:'ğŸŒŠ',diff:'med',   secret:false,boss:false},
  {id:4,name:'Ø§Ù„Ù†ÙŠØ±Ø§Ù†',    icon:'ğŸ”¥',diff:'med',   secret:false,boss:false},
  {id:5,name:'Ø§Ù„ØªÙˆØ§Ø²Ù†',    icon:'âš–ï¸', diff:'med',   secret:false,boss:false},
  {id:6,name:'Ø§Ù„Ø³Ø±Ø¹Ø©',     icon:'âš¡',diff:'hard',  secret:false,boss:false},
  {id:7,name:'Ø§Ù„Ù…ØªØ§Ù‡Ø©',    icon:'ğŸŒ€',diff:'hard',  secret:false,boss:false},
  {id:8,name:'Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬',    icon:'ğŸ°',diff:'hard',  secret:false,boss:false},
  {id:9,name:'ğŸ Ø§Ù„ÙƒÙ†Ø²',   icon:'ğŸ',diff:'secret',secret:true, boss:false},
  {id:10,name:'Ø§Ù„Ø¹Ø§ØµÙØ©',   icon:'â›ˆï¸', diff:'hard',  secret:false,boss:false},
  {id:11,name:'Ø§Ù„Ø¬Ø­ÙŠÙ…',    icon:'ğŸ‘¹',diff:'hard',  secret:false,boss:false},
  {id:12,name:'Ø§Ù„ÙØ±Ø§Øº',    icon:'ğŸŒŒ',diff:'hard',  secret:false,boss:false},
  {id:13,name:'ğŸ Ø³Ø±ÙŠØ© 2', icon:'ğŸ’',diff:'secret',secret:true, boss:false},
  {id:14,name:'Ø§Ù„ÙÙˆØ¶Ù‰ ğŸ‘Š', icon:'ğŸŒªï¸', diff:'boss',  secret:false,boss:true},
  {id:15,name:'Ø¨Ø±Ø¬ Ø§Ù„Ù…Ù„Ùƒ ğŸ‘‘',icon:'ğŸ‘‘',diff:'boss', secret:false,boss:true},
];

let canvas,ctx,gameState='menu',currentLevel=1,score=0,lives=3,gameTime=0;
let gameInterval,timeInterval,coinsThisLevel=0;
let player,platforms=[],coins=[],enemies=[],fires=[],keys={};
let currentUser=null,shieldTimer=0;

function getSave(){try{const d=localStorage.getItem('nj2_'+currentUser?.username);return d?JSON.parse(d):{totalCoins:0,unlockedLevels:[1],completedLevels:{},ownedItems:[],levelStars:{}};}catch(e){return{totalCoins:0,unlockedLevels:[1],completedLevels:{},ownedItems:[],levelStars:{}};}}
function setSave(d){localStorage.setItem('nj2_'+currentUser?.username,JSON.stringify(d));}
function addCoins(n){const d=getSave();const m=d.ownedItems.includes('coinboost')?2:1;d.totalCoins+=n*m;setSave(d);return d.totalCoins;}
function buyItem(id){const item=SHOP_ITEMS.find(i=>i.id===id);if(!item)return false;const d=getSave();if(d.ownedItems.includes(id)){showNotif('Ù„Ø¯ÙŠÙƒ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±!');return false;}if(d.totalCoins<item.price){showNotif('ğŸ’ ÙƒÙˆÙŠÙ† ØºÙŠØ± ÙƒØ§ÙÙŠØ©!');return false;}d.totalCoins-=item.price;d.ownedItems.push(id);setSave(d);showNotif('âœ… ØªÙ… Ø´Ø±Ø§Ø¡ '+item.name);return true;}
function isOwner(){return currentUser?.username===OWNER.username;}
function checkLogin(){try{const u=localStorage.getItem('nj2_session');if(u){currentUser=JSON.parse(u);return true;}return false;}catch(e){return false;}}
function loginUser(un,pw){
  if(un===OWNER.username&&pw===OWNER.password){currentUser={username:OWNER.username,isAdmin:true};localStorage.setItem('nj2_session',JSON.stringify(currentUser));return{ok:true};}
  const acc=localStorage.getItem('nj2_account');if(!acc)return{ok:false,msg:'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ØŒ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹'};
  const a=JSON.parse(acc);if(a.username!==un)return{ok:false,msg:'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± ØµØ­ÙŠØ­'};
  if(a.password!==pw)return{ok:false,msg:'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©'};
  currentUser={username:un};localStorage.setItem('nj2_session',JSON.stringify(currentUser));return{ok:true};}
function registerUser(un,pw,cf){
  if(localStorage.getItem('nj2_account'))return{ok:false,msg:'ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„!'};
  if(un.toLowerCase()==='owner')return{ok:false,msg:'âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø­Ø¬ÙˆØ²'};
  if(!un||un.length<3)return{ok:false,msg:'Ø§Ù„Ø§Ø³Ù… 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'};
  if(!pw||pw.length<4)return{ok:false,msg:'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'};
  if(pw!==cf)return{ok:false,msg:'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©'};
  localStorage.setItem('nj2_account',JSON.stringify({username:un,password:pw}));
  currentUser={username:un};localStorage.setItem('nj2_session',JSON.stringify(currentUser));return{ok:true};}
function logoutUser(){localStorage.removeItem('nj2_session');currentUser=null;clearInterval(gameInterval);clearInterval(timeInterval);gameState='menu';showScreen('loginScreen');}
function showScreen(id){document.querySelectorAll('.screen').forEach(s=>s.style.display='none');const s=document.getElementById(id);if(s)s.style.display='flex';}
function showNotif(msg,dur=2500){document.querySelectorAll('.game-notification').forEach(n=>n.remove());const n=document.createElement('div');n.className='game-notification';n.textContent=msg;document.body.appendChild(n);setTimeout(()=>n.remove(),dur);}

function initMain(){
  const d=getSave();
  document.getElementById('mainUsername').innerHTML=isOwner()?`<span class="admin-owner-badge">ğŸ‘‘ ADMIN</span> ${currentUser.username}`:currentUser.username;
  document.getElementById('mainCoins').textContent=d.totalCoins;
  renderLevels();switchTab('levels');}

function renderLevels(){
  const d=getSave(),g=document.getElementById('levelsGrid');g.innerHTML='';
  LVL.forEach(lv=>{
    const un=isOwner()||d.unlockedLevels.includes(lv.id),cp=d.completedLevels[lv.id],st=d.levelStars[lv.id]||0;
    const card=document.createElement('div');
    card.className='level-card'+(un?'':' locked')+(cp?' completed':'')+(lv.secret?' secret':'')+(lv.boss?' boss':'');
    const stH=un&&cp?['â­','â­','â­'].map((s,i)=>`<span style="opacity:${i<st?1:.2}">${s}</span>`).join(''):'';
    const dl={easy:'Ø³Ù‡Ù„',med:'Ù…ØªÙˆØ³Ø·',hard:'ØµØ¹Ø¨',boss:'ğŸ”¥ Ø¨ÙˆØ³',secret:'ğŸ Ø³Ø±ÙŠ'};
    card.innerHTML=`<span class="level-icon">${lv.icon}</span><div class="level-num">Ù…Ø±Ø­Ù„Ø© ${lv.id}</div><div class="level-name">${lv.name}</div><span class="level-difficulty diff-${lv.diff}">${dl[lv.diff]}</span>${stH?`<div class="level-stars">${stH}</div>`:''}${!un?'<div class="level-lock">ğŸ”’</div>':''}`;
    if(un)card.onclick=()=>startGame(lv.id);
    g.appendChild(card);});}

function renderShop(){
  const d=getSave(),g=document.getElementById('shopGrid');g.innerHTML='';
  SHOP_ITEMS.forEach(item=>{
    const own=d.ownedItems.includes(item.id),af=d.totalCoins>=item.price;
    const el=document.createElement('div');el.className='shop-item'+(own?' owned':'');
    el.innerHTML=`<span class="shop-icon">${item.icon}</span><div class="shop-name">${item.name}</div><div class="shop-desc">${item.desc}</div><div class="shop-price">ğŸ’ ${item.price}</div><button class="shop-buy-btn${own?' owned-btn':''}" ${own||!af?'disabled':''} onclick="handleBuy('${item.id}')">${own?'âœ… Ù…Ù…ØªÙ„Ùƒ':af?'Ø´Ø±Ø§Ø¡':'ğŸ’ ØºÙŠØ± ÙƒØ§ÙÙŠ'}</button>`;
    g.appendChild(el);});}

function handleBuy(id){if(buyItem(id)){renderShop();document.getElementById('mainCoins').textContent=getSave().totalCoins;renderProfile();}}

function renderProfile(){
  const d=getSave();
  document.getElementById('profileName').innerHTML=isOwner()?`<span class="admin-owner-badge">ğŸ‘‘ ADMIN</span> ${currentUser.username}`:currentUser.username;
  document.getElementById('pTotalCoins').textContent=d.totalCoins;
  document.getElementById('pLevelsUnlocked').textContent=isOwner()?15:d.unlockedLevels.length;
  document.getElementById('pBestLevel').textContent=isOwner()?15:Math.max(...d.unlockedLevels,1);
  document.getElementById('pItems').textContent=d.ownedItems.length;
  const list=document.getElementById('ownedList');
  list.innerHTML=d.ownedItems.length===0?'<span style="color:rgba(255,255,255,.4);font-size:.85rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚ØªÙ†ÙŠØ§Øª Ø¨Ø¹Ø¯</span>':d.ownedItems.map(id=>{const it=SHOP_ITEMS.find(s=>s.id===id);return it?`<span class="owned-tag">${it.icon} ${it.name}</span>`:''}).join('');}

function switchTab(tab){
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  const pane=document.getElementById(tab+'Tab');if(pane)pane.classList.add('active');
  const btn=document.querySelector(`[onclick="switchTab('${tab}')"]`);if(btn)btn.classList.add('active');
  if(tab==='shop')renderShop();if(tab==='profile')renderProfile();}

class Player{
  constructor(x,y){this.x=x;this.y=y;this.w=CONFIG.player.width;this.h=CONFIG.player.height;this.vx=0;this.vy=0;this.onGround=false;this.dir=1;this.invincible=false;this.invTimer=0;this.jumpsLeft=1;}
  get spd(){return CONFIG.player.speed*(getSave().ownedItems.includes('speed')?1.4:1);}
  update(){
    if(keys['ArrowRight']||keys['d']){this.vx=this.spd;this.dir=1;}
    else if(keys['ArrowLeft']||keys['a']){this.vx=-this.spd;this.dir=-1;}
    else this.vx=0;
    if((keys[' ']||keys['ArrowUp']||keys['w'])&&!keys._ju){
      const dj=getSave().ownedItems.includes('doublejump');
      if(this.onGround){this.vy=-CONFIG.player.jumpPower;this.onGround=false;this.jumpsLeft=dj?1:0;keys._ju=true;}
      else if(dj&&this.jumpsLeft>0){this.vy=-CONFIG.player.jumpPower*.85;this.jumpsLeft--;keys._ju=true;}
    }
    if(!keys[' ']&&!keys['ArrowUp']&&!keys['w'])keys._ju=false;
    if(!this.onGround){this.vy+=CONFIG.player.gravity;if(this.vy>CONFIG.player.maxFall)this.vy=CONFIG.player.maxFall;}
    this.x+=this.vx;this.y+=this.vy;
    if(this.x<0)this.x=0;if(this.x+this.w>CONFIG.canvas.width)this.x=CONFIG.canvas.width-this.w;
    if(this.y>CONFIG.canvas.height){this.hit();return;}
    this.onGround=false;let sp=null;
    platforms.forEach(p=>{if(this.x<p.x+p.width&&this.x+this.w>p.x&&this.y+this.h>p.y&&this.y+this.h<p.y+p.height+12&&this.vy>=0){this.y=p.y-this.h;this.vy=0;this.onGround=true;this.jumpsLeft=getSave().ownedItems.includes('doublejump')?2:1;sp=p;}});
    if(sp?.type==='moving')this.x+=sp.moveSpeed*sp.moveDir;
    if(this.invincible){this.invTimer--;if(this.invTimer<=0)this.invincible=false;}
    if(getSave().ownedItems.includes('magnet'))coins.forEach(c=>{if(!c.collected){const dx=(this.x+this.w/2)-(c.x+13),dy=(this.y+this.h/2)-(c.y+13),dist=Math.sqrt(dx*dx+dy*dy);if(dist<150){c.x+=dx/dist*5;c.y+=dy/dist*5;}}});}
  draw(){
    if(this.invincible&&Math.floor(Date.now()/80)%2===0)return;
    const cx=this.x+this.w/2;ctx.save();
    ctx.fillStyle='#1a2340';ctx.beginPath();ctx.roundRect(this.x+4,this.y+16,this.w-8,this.h-16,6);ctx.fill();
    ctx.fillStyle='#243050';ctx.beginPath();ctx.arc(cx,this.y+12,13,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#ff2e63';ctx.fillRect(this.x+4,this.y+7,this.w-8,6);
    ctx.fillStyle='#08d9d6';ctx.fillRect(this.dir>0?cx+2:cx-8,this.y+5,6,4);
    ctx.strokeStyle='#08d9d6';ctx.lineWidth=2.5;ctx.shadowColor='#08d9d6';ctx.shadowBlur=8;ctx.beginPath();
    if(this.dir>0){ctx.moveTo(this.x+this.w,this.y+24);ctx.lineTo(this.x+this.w+18,this.y+14);}
    else{ctx.moveTo(this.x,this.y+24);ctx.lineTo(this.x-18,this.y+14);}ctx.stroke();
    if(this.invincible&&shieldTimer>0){ctx.strokeStyle='#00ff88';ctx.lineWidth=3;ctx.shadowColor='#00ff88';ctx.shadowBlur=15;ctx.beginPath();ctx.arc(cx,this.y+this.h/2,this.w/2+8,0,Math.PI*2);ctx.stroke();}
    ctx.restore();}
  hit(){if(this.invincible)return;if(isOwner())return;lives--;updateHUD();this.invincible=true;this.invTimer=90;this.x=50;this.y=300;this.vx=0;this.vy=0;if(lives<=0)setTimeout(endGame,200);}
}
class Platform{
  constructor(x,y,w,t='normal'){this.x=x;this.y=y;this.width=w;this.height=18;this.type=t;this.moveDir=1;this.moveSpeed=2;this.originX=x;this.range=120;}
  update(){if(this.type==='moving'){this.x+=this.moveSpeed*this.moveDir;if(Math.abs(this.x-this.originX)>this.range)this.moveDir*=-1;}}
  draw(){ctx.save();ctx.shadowColor=this.type==='moving'?'#08d9d6':'#ff6b35';ctx.shadowBlur=8;const g=ctx.createLinearGradient(this.x,this.y,this.x,this.y+this.height);this.type==='moving'?(g.addColorStop(0,'#08d9d6'),g.addColorStop(1,'#056b6b')):(g.addColorStop(0,'#e05020'),g.addColorStop(1,'#8b2500'));ctx.fillStyle=g;ctx.beginPath();ctx.roundRect(this.x,this.y,this.width,this.height,5);ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.25)';ctx.lineWidth=1;ctx.stroke();ctx.restore();}
}
class Coin{
  constructor(x,y,v=1){this.x=x;this.y=y;this.w=26;this.h=26;this.collected=false;this.value=v;this.phase=Math.random()*Math.PI*2;}
  update(){this.phase+=0.06;}
  draw(){if(this.collected)return;const fy=this.y+Math.sin(this.phase)*4;ctx.save();ctx.shadowColor='#ffbb00';ctx.shadowBlur=12;const g=ctx.createRadialGradient(this.x+13,fy+10,3,this.x+13,fy+13,13);g.addColorStop(0,'#ffe566');g.addColorStop(1,'#ff8c00');ctx.fillStyle=g;ctx.beginPath();ctx.arc(this.x+13,fy+13,12,0,Math.PI*2);ctx.fill();ctx.fillStyle='#fff8';ctx.font='bold 10px Arial';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('ğŸ’',this.x+13,fy+13);ctx.restore();}
  check(p){if(this.collected)return;if(p.x<this.x+this.w&&p.x+p.w>this.x&&p.y<this.y+this.h&&p.y+p.h>this.y){this.collected=true;const m=getSave().ownedItems.includes('coinboost')?2:1;score+=10*this.value*m;coinsThisLevel+=this.value;updateHUD();}}
}
class Enemy{
  constructor(x,platform){this.platform=platform;this.w=CONFIG.enemy.width;this.h=CONFIG.enemy.height;this.x=x;this.y=platform.y-this.h;this.dir=1;this.speed=CONFIG.enemy.speed;}
  update(){this.x+=this.speed*this.dir;if(this.x+this.w>=this.platform.x+this.platform.width){this.x=this.platform.x+this.platform.width-this.w;this.dir=-1;}if(this.x<=this.platform.x){this.x=this.platform.x;this.dir=1;}this.y=this.platform.y-this.h;}
  draw(){const cx=this.x+this.w/2;ctx.save();ctx.fillStyle='#8b0000';ctx.beginPath();ctx.roundRect(this.x+3,this.y+14,this.w-6,this.h-14,5);ctx.fill();ctx.fillStyle='#c0392b';ctx.beginPath();ctx.arc(cx,this.y+10,12,0,Math.PI*2);ctx.fill();ctx.fillStyle='#7b0000';[[cx-9,this.y+3],[cx+9,this.y+3]].forEach(([hx,hy])=>{ctx.beginPath();ctx.moveTo(hx-4,hy+6);ctx.lineTo(hx,hy-2);ctx.lineTo(hx+4,hy+6);ctx.fill();});ctx.fillStyle='#ff0000';ctx.shadowColor='#ff0000';ctx.shadowBlur=8;ctx.beginPath();ctx.arc(cx-5,this.y+9,3,0,Math.PI*2);ctx.arc(cx+5,this.y+9,3,0,Math.PI*2);ctx.fill();ctx.restore();}
  check(p){if(p.invincible)return;if(p.x<this.x+this.w-4&&p.x+p.w>this.x+4&&p.y<this.y+this.h&&p.y+p.h>this.y+4)p.hit();}
}
class Fire{
  constructor(x,y){this.x=x;this.y=y;this.w=36;this.h=44;this.phase=Math.random()*Math.PI*2;}
  update(){this.phase+=0.08;}
  draw(){const fl=Math.sin(this.phase)*5;ctx.save();[['#ff2e63',0],['#ff6b35',10],['#ffbb00',18]].forEach(([c,o])=>{ctx.fillStyle=c;ctx.shadowColor=c;ctx.shadowBlur=12;ctx.beginPath();ctx.moveTo(this.x+this.w/2,this.y+fl+o);ctx.lineTo(this.x+o/2,this.y+this.h);ctx.lineTo(this.x+this.w-o/2,this.y+this.h);ctx.closePath();ctx.fill();});ctx.restore();}
  check(p){if(p.invincible)return;if(p.x<this.x+this.w-4&&p.x+p.w>this.x+4&&p.y<this.y+this.h&&p.y+p.h>this.y+6)p.hit();}
}

function loadLevel(n){
  platforms=[];coins=[];enemies=[];fires=[];coinsThisLevel=0;
  document.querySelectorAll('.ap-lvl-btn').forEach(b=>b.classList.toggle('ap-active',parseInt(b.textContent)===n));
  const d=getSave();shieldTimer=d.ownedItems.includes('shield')?600:0;
  const B=(x,y,w,t='normal')=>{const p=new Platform(x,y,w,t);platforms.push(p);return p;};
  const C=(x,y,v=1)=>coins.push(new Coin(x,y,v));
  const E=(x,p)=>enemies.push(new Enemy(x,p));
  const F=(x,y)=>fires.push(new Fire(x,y));
  B(0,480,1000);// Ø£Ø±Ø¶ÙŠØ© Ø¯Ø§Ø¦Ù…Ø©
  if(n===1){
    B(150,400,180);B(380,330,180);B(620,260,180);B(820,185,160);
    C(220,360);C(450,290);C(690,220);C(870,145);C(500,440);C(100,440);C(900,440);
  }else if(n===2){
    B(100,420,150);B(320,360,140,'moving');B(540,295,140);B(740,228,140,'moving');B(290,165,160);
    C(150,380);C(370,320);C(590,255);C(780,188);C(350,125);C(700,440);C(200,440);
  }else if(n===3){
    B(100,420,150);const p2=B(300,360,180);B(530,295,150);const p4=B(710,228,170);B(880,160,110);
    C(150,380);C(420,320);C(570,255);C(780,188);C(900,120);C(200,440);C(650,440);
    E(330,p2);E(740,p4);F(455,432);F(615,432);
  }else if(n===4){
    B(80,420,130);B(280,360,130);B(480,295,130);const p4=B(680,228,150);B(850,160,130);B(350,175,120);
    C(110,380);C(315,320);C(510,255);C(720,188);C(895,120);C(370,135);C(200,440);C(790,440);
    E(700,p4);F(175,432);F(385,432);F(575,432);F(745,432);F(915,432);
  }else if(n===5){
    B(50,440,100);const pm=B(200,380,110,'moving');B(370,320,110);const pm2=B(540,260,120,'moving');B(700,200,110);B(450,145,120);
    C(80,400);C(240,340);C(415,280);C(580,220);C(740,160);C(490,105);C(600,440);C(110,440);
    E(280,pm);F(305,432);F(630,432);
  }else if(n===6){
    const pm1=B(80,420,120,'moving');pm1.moveSpeed=3;const pm2=B(280,360,120,'moving');pm2.moveSpeed=3;
    const pm3=B(480,300,120,'moving');pm3.moveSpeed=3.5;const pm4=B(680,245,130,'moving');pm4.moveSpeed=3.5;
    B(855,185,140);B(345,155,120);
    C(110,380);C(315,320);C(515,260);C(715,205);C(895,145);C(375,115);E(690,pm4);
    F(195,432);F(435,432);F(615,432);F(795,432);
  }else if(n===7){
    B(60,450,90);B(220,400,90);const p3=B(375,350,110);B(535,295,90);const p5=B(695,240,110);
    B(555,180,90);B(375,120,120);B(175,180,90);
    C(90,410);C(255,360);C(428,310);C(575,255);C(740,200);C(595,140);C(415,80);C(215,140);
    E(395,p3);E(710,p5);F(155,432);F(455,432);F(775,432);
  }else if(n===8){
    B(100,460,90);B(100,375,90);B(100,290,90);B(100,205,90);B(100,115,90);
    const p2=B(280,385,130,'moving');const p3=B(495,305,130);const p4=B(695,228,130,'moving');B(845,150,130);
    [460,375,290,205,115].forEach((y,i)=>C(135,y-25));
    C(328,345);C(555,265);C(755,188);C(893,110);
    E(308,p2);E(710,p4);F(378,432);F(570,432);F(768,432);
  }else if(n===9){// Ø³Ø±ÙŠØ© 1 Ã—3
    B(50,440,120);B(240,380,120,'moving');B(420,320,120);B(600,260,120,'moving');B(778,200,120);
    B(195,225,100);B(495,155,120,'moving');B(345,85,200);
    for(let i=0;i<6;i++)C(80+i*155,435-i*38,3);for(let i=0;i<5;i++)C(140+i*175,380-i*58,3);
    [365,420,475,530].forEach(x=>C(x,48,3));F(295,432);F(670,432);
  }else if(n===10){
    const MP=(x,y,w,sp)=>{const p=B(x,y,w,'moving');p.moveSpeed=sp;return p;};
    const p1=MP(80,435,110,2.5);const p2=MP(255,375,110,3);const p3=MP(430,315,110,3.5);const p4=MP(608,255,110,3);const p5=MP(788,195,110,2.5);
    MP(175,215,100,2);MP(440,150,120,2.5);
    C(108,395);C(290,335);C(467,275);C(645,215);C(825,155);C(222,175);C(479,110);
    E(268,p2);E(624,p4);for(let i=0;i<5;i++)F(155+i*185,432);
  }else if(n===11){
    const p2=B(248,375,125,'moving');const p3=B(435,315,125);const p4=B(625,255,125,'moving');const p5=B(808,195,125);
    B(178,210,100);B(495,148,130);
    C(108,395);C(288,335);C(475,275);C(662,215);C(848,155);C(208,170);C(535,108);
    E(258,p2);E(455,p3);E(638,p4);for(let i=0;i<9;i++)F(48+i*103,432);
  }else if(n===12){
    const p1=B(30,468,80);const p2=B(168,420,80,'moving');const p3=B(305,372,80);const p4=B(442,324,80,'moving');
    const p5=B(578,276,80);const p6=B(715,228,80,'moving');B(855,180,90);
    B(195,188,80);B(415,130,80,'moving');B(635,80,80);B(350,32,120);
    [p1,p2,p3,p4,p5,p6].forEach((p,i)=>C(p.x+25,p.y-28));
    C(218,158);C(435,100);C(655,52);C(390,5);
    E(178,p2);E(452,p4);F(235,432);F(512,432);F(778,432);
  }else if(n===13){// Ø³Ø±ÙŠØ© 2 Ã—5
    B(50,450,100);B(208,400,100,'moving');B(365,350,100);B(522,300,100,'moving');B(678,250,100);
    B(198,230,90);B(415,172,90,'moving');B(632,118,90);B(345,58,180);
    for(let i=0;i<8;i++)C(78+i*118,445-i*48,5);for(let i=0;i<6;i++)C(365+i*48,22,5);
    C(425,62,5);C(472,62,5);F(295,432);F(592,432);F(840,432);
  }else if(n===14){
    const MP=(x,y,w,sp)=>{const p=B(x,y,w,'moving');p.moveSpeed=sp;return p;};
    const ps=[MP(58,445,95,3),MP(195,398,95,3.5),MP(332,351,95,4),MP(469,304,95,3.5),MP(606,257,95,4),MP(743,210,95,3)];
    MP(195,188,90,2.5);MP(468,132,100,3);B(692,78,120);B(342,28,150);
    ps.forEach((p,i)=>C(p.x+28,p.y-28));C(225,148);C(498,92);C(715,42);C(380,-5);
    ps.forEach(p=>E(p.x+8,p));for(let i=0;i<8;i++)F(75+i*118,432);
  }else if(n===15){
    const FL=88;
    const f1a=B(0,480,280);B(360,480,200,'moving');B(640,480,360);
    const f2a=B(55,480-FL,130);const f2b=B(252,480-FL,140,'moving');B(452,480-FL,130);const f2d=B(682,480-FL,200);
    B(125,480-FL*2,120);const f3b=B(322,480-FL*2,130,'moving');B(518,480-FL*2,130,'moving');B(722,480-FL*2,150);
    const f4a=B(85,480-FL*3,110,'moving');B(282,480-FL*3,110);const f4c=B(478,480-FL*3,110,'moving');B(698,480-FL*3,110);
    B(352,480-FL*4-8,280);
    for(let i=0;i<8;i++)C(367+i*28,480-FL*4-45,5);
    [0,1,2,3].forEach(fl=>{for(let i=0;i<4;i++)C(95+i*225,480-FL*fl-35,2+fl);});
    E(58,f1a);E(652,B(640,480,360));E(262,f2b);E(700,f2d);E(332,f3b);
    E(292,B(282,480-FL*3,110));E(708,B(698,480-FL*3,110));
    [0,1,3].forEach(fl=>{for(let i=0;i<5;i++)F(95+i*175,480-FL*fl-44);});
  }
  player=new Player(50,320);
  if(shieldTimer>0){player.invincible=true;player.invTimer=shieldTimer;}
}

function updateHUD(){
  document.getElementById('scoreDisplay').textContent=score;
  document.getElementById('livesDisplay').textContent=isOwner()?'âˆ':lives;
  document.getElementById('levelDisplay').textContent=currentLevel;
  const sh=document.getElementById('shieldHud'),sp=document.getElementById('speedHud');
  if(sh)sh.style.display=(player?.invincible&&shieldTimer>0)?'block':'none';
  if(sp)sp.style.display=getSave().ownedItems.includes('speed')?'block':'none';}
function updateTime(){gameTime++;const m=Math.floor(gameTime/60),s=gameTime%60;document.getElementById('timeDisplay').textContent=`${m}:${s.toString().padStart(2,'0')}`;}

function gameLoop(){
  if(gameState!=='playing')return;
  ctx.clearRect(0,0,CONFIG.canvas.width,CONFIG.canvas.height);
  drawBG();
  platforms.forEach(p=>{p.update();p.draw();});
  coins.forEach(c=>{c.update();c.draw();c.check(player);});
  fires.forEach(f=>{f.update();f.draw();f.check(player);});
  enemies.forEach(e=>{e.update();e.draw();e.check(player);});
  player.update();player.draw();
  if(shieldTimer>0)shieldTimer--;
  if(coins.length>0&&coins.every(c=>c.collected))completeLevel();}

function drawBG(){
  const lv=LVL[currentLevel-1];let c1='#070b1a',c2='#0d1230';
  if(lv?.diff==='hard'||lv?.boss){c1='#120308';c2='#200510';}
  if(lv?.secret){c1='#0a0820';c2='#150d30';}
  if(currentLevel===15){c1='#1a0a00';c2='#300d00';}
  const g=ctx.createLinearGradient(0,0,0,CONFIG.canvas.height);g.addColorStop(0,c1);g.addColorStop(1,c2);
  ctx.fillStyle=g;ctx.fillRect(0,0,CONFIG.canvas.width,CONFIG.canvas.height);
  ctx.fillStyle='rgba(255,255,255,0.3)';
  for(let i=0;i<40;i++)ctx.fillRect((i*173)%CONFIG.canvas.width,(i*317)%CONFIG.canvas.height,1+(i%3)*.4,1+(i%3)*.4);
  if(lv){ctx.save();ctx.globalAlpha=0.08;ctx.font='bold 90px serif';ctx.fillStyle=lv.secret?'#ff69b4':lv.boss?'#cc44ff':'#08d9d6';ctx.textAlign='center';ctx.fillText(lv.icon,CONFIG.canvas.width/2,CONFIG.canvas.height/2+45);ctx.restore();}}

function startGame(lvl=1){
  currentLevel=lvl;score=0;gameTime=0;
  const d=getSave();lives=isOwner()?999:(d.ownedItems.includes('extralives')?5:3);
  canvas.width=CONFIG.canvas.width;canvas.height=CONFIG.canvas.height;
  loadLevel(currentLevel);updateHUD();gameState='playing';showScreen('gameScreen');
  const ap=document.getElementById('adminPanel');if(ap)ap.style.display=isOwner()?'block':'none';
  const iu=document.getElementById('ingameUser');
  if(iu)iu.innerHTML=isOwner()?`<span class="admin-badge">ğŸ‘‘ ADMIN</span> ${currentUser.username}`:currentUser.username;
  clearInterval(gameInterval);clearInterval(timeInterval);
  gameLoop();gameInterval=setInterval(gameLoop,1000/60);timeInterval=setInterval(updateTime,1000);}
function pauseGame(){if(gameState!=='playing')return;gameState='paused';clearInterval(gameInterval);clearInterval(timeInterval);showScreen('pauseScreen');}
function resumeGame(){if(gameState!=='paused')return;gameState='playing';showScreen('gameScreen');gameInterval=setInterval(gameLoop,1000/60);timeInterval=setInterval(updateTime,1000);}
function endGame(){
  gameState='gameover';clearInterval(gameInterval);clearInterval(timeInterval);
  document.getElementById('go_score').textContent=score;document.getElementById('go_level').textContent=currentLevel;
  const m=Math.floor(gameTime/60),s=gameTime%60;document.getElementById('go_time').textContent=`${m}:${s.toString().padStart(2,'0')}`;
  document.getElementById('go_stars').textContent='â­'.repeat(calcStars(score));showScreen('gameOverScreen');}
function completeLevel(){
  if(gameState==='levelComplete')return;
  gameState='levelComplete';clearInterval(gameInterval);clearInterval(timeInterval);
  addCoins(coinsThisLevel);const d=getSave();const stars=calcStars(score);
  d.completedLevels[currentLevel]=true;
  if(!d.levelStars[currentLevel]||d.levelStars[currentLevel]<stars)d.levelStars[currentLevel]=stars;
  if(currentLevel<15&&!d.unlockedLevels.includes(currentLevel+1))d.unlockedLevels.push(currentLevel+1);
  if(currentLevel===8&&!d.unlockedLevels.includes(9)){d.unlockedLevels.push(9);showNotif('ğŸ ÙØªØ­Øª Ù…Ø±Ø­Ù„Ø© Ø³Ø±ÙŠØ©: Ø§Ù„ÙƒÙ†Ø²! Ã—3');}
  if(currentLevel===12&&!d.unlockedLevels.includes(13)){d.unlockedLevels.push(13);showNotif('ğŸ ÙØªØ­Øª Ø³Ø±ÙŠØ© 2: Ã—5 !');}
  setSave(d);
  const m=Math.floor(gameTime/60),s=gameTime%60;
  document.getElementById('lc_score').textContent=score;
  document.getElementById('lc_coins').textContent='+'+coinsThisLevel+(d.ownedItems.includes('coinboost')?' Ã—2':'');
  document.getElementById('lc_time').textContent=`${m}:${s.toString().padStart(2,'0')}`;
  document.getElementById('lc_stars').textContent='â­'.repeat(stars);showScreen('levelCompleteScreen');}
function calcStars(s){return s>=150?3:s>=80?2:s>=30?1:0;}
function nextLevel(){const nx=currentLevel+1;if(nx>15)goToMenu();else startGame(nx);}
function goToMenu(){clearInterval(gameInterval);clearInterval(timeInterval);gameState='menu';initMain();showScreen('mainScreen');}
function adminGoToLevel(l){startGame(l);}
function adminToggleInvincible(){if(!player)return;player.invincible=!player.invincible;player.invTimer=player.invincible?999999:0;const b=document.getElementById('btnInvincible');if(b)b.classList.toggle('ap-active',player.invincible);}
function adminSkipLevel(){completeLevel();}
function adminAddLives(){lives=999;updateHUD();}

document.addEventListener('DOMContentLoaded',()=>{
  canvas=document.getElementById('gameCanvas');ctx=canvas.getContext('2d');
  const ag=document.getElementById('apLevelGrid');
  if(ag){for(let i=1;i<=15;i++){const b=document.createElement('button');b.className='ap-lvl-btn';b.textContent=i;b.onclick=()=>adminGoToLevel(i);ag.appendChild(b);}}
  document.getElementById('registerForm').addEventListener('submit',e=>{e.preventDefault();const r=registerUser(document.getElementById('reg_user').value.trim(),document.getElementById('reg_pass').value,document.getElementById('reg_confirm').value);if(r.ok){initMain();showScreen('mainScreen');}else document.getElementById('reg_error').textContent=r.msg;});
  document.getElementById('loginForm').addEventListener('submit',e=>{e.preventDefault();const r=loginUser(document.getElementById('log_user').value.trim(),document.getElementById('log_pass').value);if(r.ok){initMain();showScreen('mainScreen');}else document.getElementById('log_error').textContent=r.msg;});
  document.getElementById('toLogin').onclick=e=>{e.preventDefault();document.getElementById('log_error').textContent='';showScreen('loginScreen');};
  document.getElementById('toRegister').onclick=e=>{e.preventDefault();document.getElementById('reg_error').textContent='';showScreen('registerScreen');};
  document.getElementById('logoutBtn').onclick=()=>{if(confirm('ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ØŸ'))logoutUser();};
  document.getElementById('pauseBtn').onclick=pauseGame;
  document.getElementById('resumeBtn').onclick=resumeGame;
  document.getElementById('restartBtn').onclick=()=>startGame(currentLevel);
  document.getElementById('quitBtn').onclick=goToMenu;
  document.getElementById('playAgainBtn').onclick=()=>startGame(currentLevel);
  document.getElementById('goToMenuBtn').onclick=goToMenu;
  document.getElementById('nextLevelBtn').onclick=nextLevel;
  document.getElementById('lc_menuBtn').onclick=goToMenu;
  document.addEventListener('keydown',e=>{keys[e.key]=true;if([' ','ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key))e.preventDefault();if(e.key==='Escape'){if(gameState==='playing')pauseGame();else if(gameState==='paused')resumeGame();}});
  document.addEventListener('keyup',e=>{keys[e.key]=false;});
  window.addEventListener('blur',()=>{if(gameState==='playing')pauseGame();});
  if(checkLogin()){initMain();showScreen('mainScreen');}
  else{const h=localStorage.getItem('nj2_account');showScreen(h?'loginScreen':'registerScreen');}
});
</script>
</body>
</html>
